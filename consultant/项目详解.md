# Java Spring Boot + LangChain4j é¡¹ç›®è¯¦è§£

## ğŸ“š ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [JavaåŸºç¡€çŸ¥è¯†](#javaåŸºç¡€çŸ¥è¯†)
3. [Spring BootåŸºç¡€](#spring-bootåŸºç¡€)
4. [é¡¹ç›®æ–‡ä»¶è¯¦è§£](#é¡¹ç›®æ–‡ä»¶è¯¦è§£)
5. [è¿è¡Œæµç¨‹](#è¿è¡Œæµç¨‹)

---

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**AIå’¨è¯¢åŠ©æ‰‹**é¡¹ç›®ï¼ŒåŠŸèƒ½æ˜¯ï¼š
- ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—® `/chat` æ¥å£
- å‘é€é—®é¢˜ï¼ˆmessageå‚æ•°ï¼‰
- ç³»ç»Ÿè°ƒç”¨DeepSeekå¤§æ¨¡å‹API
- è¿”å›AIçš„å›ç­”

**æŠ€æœ¯æ ˆï¼š**
- **Java 17** - ç¼–ç¨‹è¯­è¨€
- **Spring Boot 3.5.7** - Webæ¡†æ¶
- **LangChain4j** - AIé›†æˆæ¡†æ¶
- **DeepSeek API** - å¤§æ¨¡å‹æœåŠ¡

---

## JavaåŸºç¡€çŸ¥è¯†

### 1. åŒ…ï¼ˆPackageï¼‰
```java
package org.itheima.consultant.controller;
```
- **ä½œç”¨**ï¼šç»„ç»‡ä»£ç ï¼Œé¿å…ç±»åå†²çª
- **ç±»æ¯”**ï¼šå°±åƒæ–‡ä»¶å¤¹ï¼ŒæŠŠç›¸å…³çš„ç±»æ”¾åœ¨ä¸€èµ·
- **å‘½åè§„åˆ™**ï¼šé€šå¸¸ç”¨åŸŸåå€’åºï¼Œå¦‚ `com.company.project`

### 2. ç±»ï¼ˆClassï¼‰
```java
public class ChatController {
    // ç±»çš„ä»£ç 
}
```
- **ä½œç”¨**ï¼šJavaçš„åŸºæœ¬ä»£ç ç»„ç»‡å•ä½
- **public**ï¼šè¡¨ç¤ºè¿™ä¸ªç±»å¯ä»¥è¢«å…¶ä»–åŒ…è®¿é—®

### 3. æ¥å£ï¼ˆInterfaceï¼‰
```java
public interface ConsultantService {
    public String chat(String message);
}
```
- **ä½œç”¨**ï¼šå®šä¹‰æ–¹æ³•ç­¾åï¼Œä¸å®ç°å…·ä½“é€»è¾‘
- **ç‰¹ç‚¹**ï¼šæ¥å£ä¸­çš„æ–¹æ³•åªæœ‰å£°æ˜ï¼Œæ²¡æœ‰å®ç°
- **å¥½å¤„**ï¼šå®šä¹‰è§„èŒƒï¼Œå…·ä½“å®ç°ç”±æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆ

### 4. æ–¹æ³•ï¼ˆMethodï¼‰
```java
public String chat(String message) {
    // æ–¹æ³•ä½“
}
```
- **public**ï¼šå…¬å¼€æ–¹æ³•ï¼Œå¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨
- **String**ï¼šè¿”å›ç±»å‹ï¼ˆè¿”å›å­—ç¬¦ä¸²ï¼‰
- **chat**ï¼šæ–¹æ³•å
- **String message**ï¼šå‚æ•°ï¼ˆæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„messageï¼‰

### 5. æ³¨è§£ï¼ˆAnnotationï¼‰
Javaä¸­çš„æ³¨è§£ä»¥ `@` å¼€å¤´ï¼Œç”¨äºç»™ä»£ç æ·»åŠ å…ƒæ•°æ®ï¼ˆè¯´æ˜ä¿¡æ¯ï¼‰

å¸¸è§æ³¨è§£ï¼š
- `@RestController` - æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªRESTæ§åˆ¶å™¨
- `@Autowired` - è‡ªåŠ¨æ³¨å…¥ä¾èµ–
- `@RequestMapping` - æ˜ å°„HTTPè¯·æ±‚è·¯å¾„
- `@SpringBootApplication` - æ ‡è¯†è¿™æ˜¯Spring Bootåº”ç”¨å…¥å£

---

## Spring BootåŸºç¡€

### ä»€ä¹ˆæ˜¯Spring Bootï¼Ÿ
Spring Bootæ˜¯ä¸€ä¸ª**ç®€åŒ–Springå¼€å‘çš„æ¡†æ¶**ï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºç‹¬ç«‹çš„ã€ç”Ÿäº§çº§çš„åº”ç”¨ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

#### 1. ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰
```java
@Autowired
private ConsultantService consultantService;
```
- **ä½œç”¨**ï¼šSpringè‡ªåŠ¨åˆ›å»ºå¯¹è±¡å¹¶æ³¨å…¥ï¼Œä¸éœ€è¦æ‰‹åŠ¨ `new`
- **å¥½å¤„**ï¼šè§£è€¦ï¼Œæ–¹ä¾¿æµ‹è¯•å’Œç»´æŠ¤

#### 2. æ§åˆ¶å™¨ï¼ˆControllerï¼‰
```java
@RestController
public class ChatController {
    @RequestMapping("/chat")
    public String chat(String message) {
        // å¤„ç†è¯·æ±‚
    }
}
```
- **@RestController**ï¼šæ ‡è¯†è¿™æ˜¯REST APIæ§åˆ¶å™¨
- **@RequestMapping("/chat")**ï¼šæ˜ å°„URLè·¯å¾„
- å½“è®¿é—® `http://localhost:8080/chat?message=ä½ å¥½` æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•

#### 3. é…ç½®ç±»ï¼ˆConfigurationï¼‰
```java
@Configuration
public class CommonConfig {
    // é…ç½®Bean
}
```
- **ä½œç”¨**ï¼šå®šä¹‰Springå®¹å™¨ä¸­çš„Beanï¼ˆå¯¹è±¡ï¼‰
- **@Bean**ï¼šæ ‡è®°æ–¹æ³•ï¼Œè¿”å›çš„å¯¹è±¡ä¼šè¢«Springç®¡ç†

---

## é¡¹ç›®æ–‡ä»¶è¯¦è§£

### 1. pom.xml - Mavenä¾èµ–ç®¡ç†

```xml
<dependencies>
    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- LangChain4j OpenAIé›†æˆ -->
    <dependency>
        <groupId>dev.langchain4j</groupId>
        <artifactId>langchain4j-open-ai-spring-boot-starter</artifactId>
    </dependency>
    
    <!-- LangChain4j AiServices -->
    <dependency>
        <groupId>dev.langchain4j</groupId>
        <artifactId>langchain4j-spring-boot-starter</artifactId>
    </dependency>
</dependencies>
```

**è§£é‡Šï¼š**
- **Maven**ï¼šJavaçš„ä¾èµ–ç®¡ç†å·¥å…·ï¼ˆç±»ä¼¼Node.jsçš„npmï¼‰
- **dependency**ï¼šå£°æ˜é¡¹ç›®éœ€è¦çš„å¤–éƒ¨åº“
- **groupId + artifactId**ï¼šå”¯ä¸€æ ‡è¯†ä¸€ä¸ªåº“
- **version**ï¼šåº“çš„ç‰ˆæœ¬å·

---

### 2. ConsultantApplication.java - åº”ç”¨å…¥å£

```java
@SpringBootApplication
public class ConsultantApplication {
    public static void main(String[] args) {
        SpringApplication.run(ConsultantApplication.class, args);
    }
}
```

**é€è¡Œè§£é‡Šï¼š**
- `@SpringBootApplication`ï¼šå‘Šè¯‰Spring Bootè¿™æ˜¯ä¸»åº”ç”¨ç±»
- `public static void main(String[] args)`ï¼šJavaç¨‹åºçš„å…¥å£æ–¹æ³•
- `SpringApplication.run(...)`ï¼šå¯åŠ¨Spring Bootåº”ç”¨

**ç±»æ¯”**ï¼šå°±åƒç¨‹åºçš„"å¼€å…³"ï¼Œå¯åŠ¨æ•´ä¸ªåº”ç”¨

---

### 3. application.yml - é…ç½®æ–‡ä»¶

```yaml
langchain4j:
  open-ai:
    chat-model:
      base-url: https://api.deepseek.com
      api-key: ${DEEPSEEK_API_KEY}
      model-name: deepseek-chat
      log-requests: true
      log-responses: true
```

**è§£é‡Šï¼š**
- **YAMLæ ¼å¼**ï¼šä¸€ç§æ˜“è¯»çš„é…ç½®æ–‡ä»¶æ ¼å¼
- **base-url**ï¼šAPIçš„åŸºç¡€åœ°å€ï¼ˆDeepSeekçš„APIåœ°å€ï¼‰
- **api-key**ï¼šAPIå¯†é’¥ï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
- **model-name**ï¼šä½¿ç”¨çš„æ¨¡å‹åç§°
- **log-requests/responses**ï¼šæ˜¯å¦è®°å½•è¯·æ±‚å’Œå“åº”æ—¥å¿—

**ç¯å¢ƒå˜é‡è®¾ç½®ï¼š**
```bash
export DEEPSEEK_API_KEY="ä½ çš„APIå¯†é’¥"
```

---

### 4. ConsultantService.java - AIæœåŠ¡æ¥å£

```java
@AiService(
    wiringMode = AiServiceWiringMode.EXPLICIT,
    chatModel = "openAiChatModel"
)
public interface ConsultantService {
    public String chat(String message);
}
```

**è§£é‡Šï¼š**
- **@AiService**ï¼šLangChain4jçš„æ³¨è§£ï¼Œè‡ªåŠ¨ç”ŸæˆAIæœåŠ¡å®ç°
- **wiringMode = EXPLICIT**ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨çš„æ¨¡å‹
- **chatModel = "openAiChatModel"**ï¼šä½¿ç”¨åä¸º"openAiChatModel"çš„æ¨¡å‹
- **interface**ï¼šæ¥å£ï¼Œåªå®šä¹‰æ–¹æ³•ç­¾å
- **chatæ–¹æ³•**ï¼šæ¥æ”¶ç”¨æˆ·æ¶ˆæ¯ï¼Œè¿”å›AIå›ç­”

**ç¥å¥‡ä¹‹å¤„**ï¼šä½ åªéœ€è¦å®šä¹‰æ¥å£ï¼ŒLangChain4jä¼šè‡ªåŠ¨å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨å¤§æ¨¡å‹APIï¼

---

### 5. CommonConfig.java - é…ç½®ç±»

```java
@Configuration
public class CommonConfig {
    @Autowired
    private OpenAiChatModel model;
    
    // æ³¨é‡Šæ‰çš„ä»£ç æ˜¯æ‰‹åŠ¨åˆ›å»ºBeançš„æ–¹å¼
}
```

**è§£é‡Šï¼š**
- **@Configuration**ï¼šæ ‡è¯†è¿™æ˜¯é…ç½®ç±»
- **@Autowired**ï¼šè‡ªåŠ¨æ³¨å…¥OpenAiChatModelå¯¹è±¡ï¼ˆç”±LangChain4jè‡ªåŠ¨åˆ›å»ºï¼‰
- **æ³¨é‡Šçš„ä»£ç **ï¼šå±•ç¤ºäº†å¦‚ä½•æ‰‹åŠ¨åˆ›å»ºConsultantServiceï¼Œä½†å½“å‰ä½¿ç”¨@AiServiceè‡ªåŠ¨åˆ›å»º

---

### 6. ChatController.java - æ§åˆ¶å™¨

```java
@RestController
public class ChatController {
    @Autowired
    private ConsultantService consultantService;
    
    @RequestMapping("/chat")
    public String chat(String message) {
        String result = consultantService.chat(message);
        return result;
    }
}
```

**é€è¡Œè§£é‡Šï¼š**

1. **@RestController**ï¼š
   - æ ‡è¯†è¿™æ˜¯REST APIæ§åˆ¶å™¨
   - è‡ªåŠ¨å°†è¿”å›å€¼è½¬æ¢ä¸ºJSONæˆ–å­—ç¬¦ä¸²

2. **@Autowired private ConsultantService**ï¼š
   - Springè‡ªåŠ¨æ³¨å…¥ConsultantServiceå¯¹è±¡
   - ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š`new ConsultantService()`

3. **@RequestMapping("/chat")**ï¼š
   - æ˜ å°„URLè·¯å¾„
   - è®¿é—® `http://localhost:8080/chat?message=ä½ å¥½` ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•

4. **public String chat(String message)**ï¼š
   - `public`ï¼šå…¬å¼€æ–¹æ³•
   - `String`ï¼šè¿”å›ç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼‰
   - `String message`ï¼šæ¥æ”¶URLå‚æ•°message

5. **æ–¹æ³•ä½“**ï¼š
   - è°ƒç”¨consultantService.chat(message)è·å–AIå›ç­”
   - è¿”å›ç»“æœç»™æµè§ˆå™¨

**æ³¨é‡Šæ‰çš„ä»£ç **ï¼š
- å±•ç¤ºäº†ç›´æ¥ä½¿ç”¨OpenAiChatModelçš„æ–¹å¼
- å½“å‰ä½¿ç”¨ConsultantServiceï¼ˆæ›´ä¼˜é›…çš„æ–¹å¼ï¼‰

---

## è¿è¡Œæµç¨‹

### å®Œæ•´è¯·æ±‚æµç¨‹ï¼š

```
1. ç”¨æˆ·è®¿é—®æµè§ˆå™¨
   â†“
   http://localhost:8080/chat?message=ä½ å¥½
   
2. Spring Bootæ¥æ”¶è¯·æ±‚
   â†“
   è·¯ç”±åˆ° ChatController.chat() æ–¹æ³•
   
3. Controllerè°ƒç”¨Service
   â†“
   consultantService.chat("ä½ å¥½")
   
4. ConsultantServiceï¼ˆç”±LangChain4jè‡ªåŠ¨å®ç°ï¼‰
   â†“
   è°ƒç”¨ OpenAiChatModelï¼Œå‘é€è¯·æ±‚åˆ°DeepSeek API
   
5. DeepSeek APIè¿”å›å›ç­”
   â†“
   é€šè¿‡Service â†’ Controller â†’ è¿”å›ç»™æµè§ˆå™¨
   
6. ç”¨æˆ·åœ¨æµè§ˆå™¨çœ‹åˆ°AIå›ç­”
```

### å¯åŠ¨åº”ç”¨ï¼š

1. **è®¾ç½®ç¯å¢ƒå˜é‡**ï¼š
```bash
export DEEPSEEK_API_KEY="ä½ çš„APIå¯†é’¥"
```

2. **è¿è¡Œä¸»ç±»**ï¼š
   - åœ¨IDEä¸­è¿è¡Œ `ConsultantApplication.main()`
   - æˆ–ä½¿ç”¨Mavenï¼š`mvn spring-boot:run`

3. **è®¿é—®æ¥å£**ï¼š
   - æµè§ˆå™¨ï¼š`http://localhost:8080/chat?message=ä½ å¥½`
   - æˆ–ä½¿ç”¨curlï¼š
```bash
curl "http://localhost:8080/chat?message=ä½ å¥½"
```

---

## å…³é”®æ¦‚å¿µæ€»ç»“

### 1. æ³¨è§£çš„ä½œç”¨
- `@RestController` â†’ æ ‡è¯†è¿™æ˜¯APIæ§åˆ¶å™¨
- `@Autowired` â†’ è‡ªåŠ¨æ³¨å…¥ä¾èµ–
- `@RequestMapping` â†’ æ˜ å°„URLè·¯å¾„
- `@AiService` â†’ è‡ªåŠ¨ç”ŸæˆAIæœåŠ¡å®ç°
- `@SpringBootApplication` â†’ æ ‡è¯†ä¸»åº”ç”¨ç±»

### 2. ä¾èµ–æ³¨å…¥çš„å¥½å¤„
**ä¼ ç»Ÿæ–¹å¼**ï¼ˆä¸æ¨èï¼‰ï¼š
```java
ConsultantService service = new ConsultantService(); // æ‰‹åŠ¨åˆ›å»º
```

**Springæ–¹å¼**ï¼ˆæ¨èï¼‰ï¼š
```java
@Autowired
private ConsultantService service; // Springè‡ªåŠ¨åˆ›å»ºå’Œæ³¨å…¥
```

**å¥½å¤„**ï¼š
- è§£è€¦ï¼šä¸éœ€è¦çŸ¥é“å¦‚ä½•åˆ›å»ºå¯¹è±¡
- æ–¹ä¾¿æµ‹è¯•ï¼šå¯ä»¥è½»æ¾æ›¿æ¢ä¸ºMockå¯¹è±¡
- ç»Ÿä¸€ç®¡ç†ï¼šSpringç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ

### 3. æ¥å£ vs å®ç°
- **æ¥å£**ï¼šå®šä¹‰"åšä»€ä¹ˆ"ï¼ˆå¦‚ï¼šchatæ–¹æ³•æ¥æ”¶æ¶ˆæ¯è¿”å›å›ç­”ï¼‰
- **å®ç°**ï¼šå®šä¹‰"æ€ä¹ˆåš"ï¼ˆLangChain4jè‡ªåŠ¨å®ç°ï¼Œè°ƒç”¨å¤§æ¨¡å‹APIï¼‰

### 4. é…ç½®æ–‡ä»¶çš„ä½œç”¨
- **application.yml**ï¼šé›†ä¸­ç®¡ç†é…ç½®ï¼ˆAPIåœ°å€ã€å¯†é’¥ç­‰ï¼‰
- **å¥½å¤„**ï¼šä¿®æ”¹é…ç½®ä¸éœ€è¦æ”¹ä»£ç ï¼Œåªéœ€æ”¹é…ç½®æ–‡ä»¶

---

## å­¦ä¹ å»ºè®®

1. **ç†è§£æ³¨è§£**ï¼šSpring Bootå¤§é‡ä½¿ç”¨æ³¨è§£ï¼Œç†è§£æ¯ä¸ªæ³¨è§£çš„ä½œç”¨
2. **ç†è§£ä¾èµ–æ³¨å…¥**ï¼šè¿™æ˜¯Springçš„æ ¸å¿ƒæ¦‚å¿µ
3. **ç†è§£æ¥å£**ï¼šæ¥å£å®šä¹‰è§„èŒƒï¼Œå®ç°ç”±æ¡†æ¶å®Œæˆ
4. **ç†è§£è¯·æ±‚æµç¨‹**ï¼šä»æµè§ˆå™¨è¯·æ±‚åˆ°è¿”å›ç»“æœçš„å®Œæ•´æµç¨‹
5. **åŠ¨æ‰‹å®è·µ**ï¼š
   - ä¿®æ”¹URLè·¯å¾„
   - æ·»åŠ æ–°çš„æ¥å£æ–¹æ³•
   - ä¿®æ”¹é…ç½®æ–‡ä»¶å‚æ•°

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆConsultantServiceæ˜¯æ¥å£è€Œä¸æ˜¯ç±»ï¼Ÿ
**A**: å› ä¸ºä½¿ç”¨äº†`@AiService`æ³¨è§£ï¼ŒLangChain4jä¼šè‡ªåŠ¨ç”Ÿæˆå®ç°ç±»ã€‚ä½ åªéœ€è¦å®šä¹‰æ¥å£ï¼Œæ¡†æ¶ä¼šå¤„ç†å…·ä½“å®ç°ã€‚

### Q2: @Autowiredæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
**A**: Springåœ¨å¯åŠ¨æ—¶ä¼šæ‰«ææ‰€æœ‰ç±»ï¼Œæ‰¾åˆ°æ ‡è®°äº†`@Autowired`çš„å­—æ®µï¼Œç„¶åè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„å¯¹è±¡å¹¶æ³¨å…¥ã€‚

### Q3: ç¯å¢ƒå˜é‡åœ¨å“ªé‡Œè®¾ç½®ï¼Ÿ
**A**: 
- **Linux/Mac**: `export DEEPSEEK_API_KEY="ä½ çš„å¯†é’¥"`
- **Windows**: `set DEEPSEEK_API_KEY=ä½ çš„å¯†é’¥`
- **IDE**: åœ¨è¿è¡Œé…ç½®ä¸­è®¾ç½®ç¯å¢ƒå˜é‡

### Q4: å¦‚ä½•è°ƒè¯•ï¼Ÿ
**A**: 
- åœ¨æ–¹æ³•ä¸­æ‰“æ–­ç‚¹
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼ˆapplication.ymlä¸­è®¾ç½®äº†æ—¥å¿—ï¼‰
- ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•æ¥å£

---

## ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘

1. **Spring Bootè¿›é˜¶**ï¼š
   - å­¦ä¹ æ›´å¤šæ³¨è§£ï¼ˆ@Service, @Componentç­‰ï¼‰
   - å­¦ä¹ å¼‚å¸¸å¤„ç†
   - å­¦ä¹ æ•°æ®éªŒè¯

2. **LangChain4jè¿›é˜¶**ï¼š
   - RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰
   - Toolsï¼ˆå·¥å…·è°ƒç”¨ï¼‰
   - æµå¼å“åº”

3. **é¡¹ç›®ä¼˜åŒ–**ï¼š
   - æ·»åŠ å¼‚å¸¸å¤„ç†
   - æ·»åŠ æ—¥å¿—è®°å½•
   - æ·»åŠ å‚æ•°éªŒè¯
   - æ·»åŠ å•å…ƒæµ‹è¯•

