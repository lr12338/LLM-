# èˆ¹èˆ¶æŠ¥è­¦è¯†åˆ«Agent

åŸºäºLangGraphæ¡†æ¶å¼€å‘çš„æ™ºèƒ½èˆ¹èˆ¶æŠ¥è­¦è¯†åˆ«ç³»ç»Ÿï¼Œç”¨äºè‡ªåŠ¨åˆ†æèˆ¹èˆ¶ç›‘æ§å›¾ç‰‡ï¼Œåˆ¤æ–­æŠ¥è­¦äº‹ä»¶æ˜¯å¦çœŸå®ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
HifleetAIVideo/
â”œâ”€â”€ aiVideo.py              # åŸå§‹å‚è€ƒä»£ç 
â”œâ”€â”€ shipAlertAgent.py        # èˆ¹èˆ¶æŠ¥è­¦è¯†åˆ«Agentä¸»ç¨‹åº
â”œâ”€â”€ batch_process.py         # æ‰¹é‡å¤„ç†è„šæœ¬
â”œâ”€â”€ config.py               # é…ç½®æ–‡ä»¶ï¼ˆAPIå¯†é’¥ç­‰ï¼‰
â”œâ”€â”€ éœ€æ±‚æ–‡æ¡£_èˆ¹èˆ¶æŠ¥è­¦è¯†åˆ«Agent.md  # äº§å“éœ€æ±‚æ–‡æ¡£
â”œâ”€â”€ æµç¨‹å›¾è®¾è®¡.md            # æµç¨‹å›¾è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ ä½¿ç”¨æ–‡æ¡£.md              # ä½¿ç”¨è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ README.md               # æœ¬æ–‡ä»¶
â””â”€â”€ dataset/
    â”œâ”€â”€ imgUrl.txt         # æµ‹è¯•æ•°æ®æ–‡ä»¶
    â””â”€â”€ img/               # å›¾ç‰‡ç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install langchain langchain-openai langgraph typing-extensions
```

### 2. é…ç½®APIå¯†é’¥

ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œè®¾ç½®æ­£ç¡®çš„APIå¯†é’¥ï¼š
```python
huoshan_api_key = "your_api_key_here"
```

### 3. è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
python shipAlertAgent.py
```

### 4. æ‰¹é‡å¤„ç†

```bash
python batch_process.py
```

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šäº‹ä»¶ç±»å‹æ”¯æŒ**ï¼šCallingï¼ˆæ‰“ç”µè¯ï¼‰ã€Smokingï¼ˆå¸çƒŸï¼‰ã€Driver-CloseEyesï¼ˆé—­çœ¼ï¼‰ã€Smokeï¼ˆçƒŸé›¾ï¼‰
- âœ… **å¤šåœ°ç‚¹æ”¯æŒ**ï¼šé©¾é©¶å°ã€ä¸»ç”²æ¿
- âœ… **æ™ºèƒ½è·¯ç”±**ï¼šæ ¹æ®åœ°ç‚¹å’Œäº‹ä»¶ç±»å‹è‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„åˆ†ææ¨¡å—
- âœ… **ç»“æ„åŒ–è¾“å‡º**ï¼šè¿”å›JSONæ ¼å¼çš„æ£€æµ‹ç»“æœ
- âœ… **è§„åˆ™åˆ¤æ–­**ï¼šåŸºäºæ£€æµ‹æ¡ä»¶ç»¼åˆåˆ¤æ–­æŠ¥è­¦çœŸå®æ€§
- âœ… **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡å¤„ç†å¤šä¸ªäº‹ä»¶

## ğŸ”„ å·¥ä½œæµç¨‹

```
Start â†’ äº‹ä»¶åˆ¤æ–­æ¨¡å— â†’ ä»»åŠ¡æ¨¡å—ï¼ˆAIåˆ†æï¼‰ â†’ ç»“æœåˆ¤æ–­æ¨¡å— â†’ äº‹ä»¶ä¸Šä¼  â†’ End
```

è¯¦ç»†æµç¨‹è¯·å‚è€ƒ `æµç¨‹å›¾è®¾è®¡.md`ã€‚

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```python
from shipAlertAgent import create_ship_alert_workflow

# åˆ›å»ºå·¥ä½œæµ
app = create_ship_alert_workflow()

# å‡†å¤‡è¾“å…¥
input_data = {
    "messages": [],
    "video_event_record_id": "1993846874922176512",
    "camera_name": "é©¾é©¶å°",
    "events_type": "Calling",
    "snap_url": "https://static.hifleet.com/video_event/413601240/995e30e0-1673-409d-8d6f-bca169cd8b78.jpeg",
    "detection_result": {},
    "matched": 0,
    "reason": "",
    "route_key": ""
}

# æ‰§è¡Œåˆ†æ
result = app.invoke(input_data, config={"configurable": {"thread_id": "test_1"}})

# æŸ¥çœ‹ç»“æœ
print(f"matched: {result.get('matched')}")  # 1=çœŸå®æŠ¥è­¦ï¼Œ0=è¯¯è¯†åˆ«
print(f"reason: {result.get('reason')}")
```

## ğŸ“Š è¾“å‡ºæ ¼å¼

```json
{
  "video_event_record_id": "1993846874922176512",
  "camera_name": "é©¾é©¶å°",
  "events_type": "Calling",
  "snap_url": "https://...",
  "detection_result": {
    "has_human_body": true,
    "hand_holding_phone": true,
    "phone_near_ear_or_face": true,
    "landline_telephone": false,
    "upper_body_fully_visible": true,
    "reason": "åˆ¤æ–­åŸå› ",
    "content": "å›¾ç‰‡ç®€è¿°"
  },
  "matched": 1,
  "reason": "ç»¼åˆåˆ¤æ–­åŸå› "
}
```

## ğŸ“š æ–‡æ¡£

- [äº§å“éœ€æ±‚æ–‡æ¡£](éœ€æ±‚æ–‡æ¡£_èˆ¹èˆ¶æŠ¥è­¦è¯†åˆ«Agent.md)
- [æµç¨‹å›¾è®¾è®¡](æµç¨‹å›¾è®¾è®¡.md)
- [ä½¿ç”¨æ–‡æ¡£](ä½¿ç”¨æ–‡æ¡£.md)

## ğŸ”§ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°çš„äº‹ä»¶ç±»å‹

1. åœ¨ `shipAlertAgent.py` çš„ `PROMPT_TEMPLATES` ä¸­æ·»åŠ æ–°çš„æç¤ºè¯æ¨¡æ¿
2. åœ¨ `result_judge_node` å‡½æ•°ä¸­æ·»åŠ å¯¹åº”çš„åˆ¤æ–­è§„åˆ™
3. ç¡®ä¿ `route_key` æ ¼å¼ä¸º `{camera_name}_{events_type}`

### ä¿®æ”¹åˆ¤æ–­è§„åˆ™

åœ¨ `result_judge_node` å‡½æ•°ä¸­ï¼Œæ‰¾åˆ°å¯¹åº”çš„äº‹ä»¶ç±»å‹åˆ¤æ–­é€»è¾‘ï¼Œä¿®æ”¹æ¡ä»¶å³å¯ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿APIå¯†é’¥é…ç½®æ­£ç¡®
2. å›¾ç‰‡URLéœ€è¦å¯å…¬å¼€è®¿é—®
3. æ¨¡å‹è°ƒç”¨å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
4. æ‰¹é‡å¤„ç†æ—¶å»ºè®®è®¾ç½®åˆç†çš„å¹¶å‘æ•°

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-12)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒ4ç§äº‹ä»¶ç±»å‹
- æ”¯æŒ2ä¸ªç›‘æ§åœ°ç‚¹
- å®ç°å®Œæ•´çš„Agentå·¥ä½œæµ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

